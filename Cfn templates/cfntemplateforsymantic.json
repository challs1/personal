{"Mappings":{"AWSRegionArch2AMIPU":{"us-west-1":{"HVM64":"ami-0c897b47dd3cba95f"},"ap-northeast-2":{"HVM64":"ami-0d64e46f2e08ed707"},"us-east-2":{"HVM64":"ami-0eca663f8e475ac7c"},"ap-southeast-2":{"HVM64":"ami-0a370918cba7b902a"},"eu-west-1":{"HVM64":"ami-09b0585ab72af04e8"},"sa-east-1":{"HVM64":"ami-0bdfc7ad3934cb50f"},"ap-southeast-1":{"HVM64":"ami-03d1ae34dadf1a534"},"ca-central-1":{"HVM64":"ami-082e2f46e95024653"},"us-east-1":{"HVM64":"ami-0f9a0647205a76335"},"us-west-2":{"HVM64":"ami-09e0cc3375c1b1d60"},"ap-south-1":{"HVM64":"ami-062ee099616a6d443"},"eu-central-1":{"HVM64":"ami-0833d44c795089393"},"ap-northeast-1":{"HVM64":"ami-0876c319def2c27a4"},"eu-west-2":{"HVM64":"ami-0283daebaf4154987"}},"AWSInstanceType2Arch":{"t2.xlarge":{"Arch":"HVM64"},"c4.4xlarge":{"Arch":"HVM64"},"m4.2xlarge":{"Arch":"HVM64"},"m4.xlarge":{"Arch":"HVM64"},"c4.xlarge":{"Arch":"HVM64"},"c4.2xlarge":{"Arch":"HVM64"},"m4.large":{"Arch":"HVM64"}},"AWSRegionArch2AMIController":{"us-west-1":{"HVM64":"ami-0bf6f00f47382ac78"},"ap-northeast-2":{"HVM64":"ami-0b4a00f3c22fc010c"},"us-east-2":{"HVM64":"ami-0ca6e9b867e4c6f2a"},"ap-southeast-2":{"HVM64":"ami-06006cf934089b6fb"},"eu-west-1":{"HVM64":"ami-0bfd84b9a099ff685"},"sa-east-1":{"HVM64":"ami-006650979d5f3f84a"},"ap-southeast-1":{"HVM64":"ami-0d2c06a269412a926"},"ca-central-1":{"HVM64":"ami-0791a3603e6f58147"},"us-east-1":{"HVM64":"ami-0bbddcb36f7717fda"},"us-west-2":{"HVM64":"ami-0116aa106036371d6"},"ap-south-1":{"HVM64":"ami-0d5fbd0cd3abefd46"},"eu-central-1":{"HVM64":"ami-00b53774b39b7fa3f"},"ap-northeast-1":{"HVM64":"ami-0e16cb1432ea15a22"},"eu-west-2":{"HVM64":"ami-0cd1ff60ad5334c3f"}}},"Parameters":{"ProxyPort":{"Description":"Provide port to connect to proxy server","Default":0,"Type":"Number","MaxValue":65535,"MinValue":0,"ConstraintDescription":"Provide port number between 0-65535. Specify value as 0 if no proxy configuration is required."},"MinimumPUInstances":{"Description":"Enter any value from 0 to 20.","Default":1,"Type":"Number","MaxValue":20,"MinValue":0,"ConstraintDescription":"MinimumPUInstances must be between 0 and 20 (both inclusive)."},"VPCID":{"MinLength":"1","Type":"AWS::EC2::VPC::Id","Description":"Select VPC ID.","ConstraintDescription":"VPC ID is a mandatory input parameter. Select an existing VPC ID."},"DesiredPUInstances":{"Description":"Enter any value from 0 to 20. Desired PU Instances must be between Minimum PU Instances and Maximum PU Instances values.","Default":1,"Type":"Number","MaxValue":20,"MinValue":0,"ConstraintDescription":"Desired PU Instances must be between Minimum PU Instances and Maximum PU Instances values."},"ProxyUser":{"Type":"String","Description":"If using authenticated mode, provide proxy user name"},"Namespace":{"Default":"CWPForStorage","AllowedPattern":"^[a-zA-Z][a-zA-Z0-9-]{1,64}$","Type":"String","Description":"Prefix is used in naming AWS resources like DynamoDB Tables, SQS, Alarms, Controller Instance that CloudFormation template creates. We recommend that you use your own prefix instead of the default, especially when you have deployed the stack in the same region in the past.","ConstraintDescription":"Prefix can contain only alphanumeric characters (case sensitive) and hyphens. It must start with an alphabetic character and cannot be longer than 64 characters. It cannot be blank"},"SSHLocation":{"Type":"String","Description":"Specify  the location from which administrators are allowed to access Command Gateway on Controller EC2 instance. By default, the Command Gateway can be accessed from any location.","Default":"0.0.0.0/0","MinLength":"9","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","MaxLength":"18","ConstraintDescription":"SSHLocation must be a valid CIDR range of the form x.x.x.x/x."},"DomainId":{"MinLength":1,"Type":"String"},"Email":{"AllowedPattern":"^[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$","MinLength":"1","Type":"String","Description":"Enter an Email ID to get EC2 termination notifications.","ConstraintDescription":"Email is a mandatory input parameter. Enter a valid email address."},"KeyPairName":{"MinLength":"1","Type":"AWS::EC2::KeyPair::KeyName","Description":"Select an existing key pair to access EC2 instance.","ConstraintDescription":"KeyPairName is a mandatory input parameter. Select a valid EC2 KeyPair."},"Subnets":{"MinLength":"1","Type":"List<AWS::EC2::Subnet::Id>","Description":"Select subnets from the selected VPC.","ConstraintDescription":"Subnets is a mandatory input parameter. Select subnets from the selected VPC."},"Enable":{"Default":"Yes","Type":"String","Description":"Select 'No' to disable Near Real-Time Scan.","AllowedValues":["Yes","No"]},"CustomerId":{"MinLength":1,"Type":"String"},"SecretKey":{"Type":"String","NoEcho":"true"},"PUInstanceType":{"Default":"c4.4xlarge","Type":"String","Description":"Select PU EC2 instance type.","AllowedValues":["m4.large","m4.xlarge","m4.2xlarge","c4.xlarge","c4.2xlarge","c4.4xlarge"]},"ControllerInstanceType":{"Default":"m4.2xlarge","Type":"String","Description":"Select Controller EC2 instance type.","AllowedValues":["m4.large","m4.xlarge","m4.2xlarge","c4.xlarge","c4.2xlarge","c4.4xlarge"]},"AutomaticBucketConfiguration":{"Default":"Configure automatically (Link through SNS & SQS)","Type":"String","Description":"Select 'Configure automatically' if you want to scan latest updates in all S3 buckets using Near Real-Time Scan.","AllowedValues":["Configure automatically (Link through SNS & SQS)","Do Not Configure"]},"ProxyPassword":{"NoEcho":"true","Type":"String","Description":"Provide password for authentication to proxy server"},"LUAServer":{"AllowedPattern":"(^(((25[0-5])|(2[0-4][0-9])|(1[0-9][0-9])|([1-9][0-9])|([1-9]))[.]((25[0-5])|(2[0-4][0-9])|(1[0-9][0-9])|([1-9][0-9])|([0-9]))[.]((25[0-5])|(2[0-4][0-9])|(1[0-9][0-9])|([1-9][0-9])|([0-9]))[.]((25[0-5])|(2[0-4][0-9])|(1[0-9][0-9])|([1-9][0-9])|([0-9])))$|(^$))","Type":"String","ConstraintDescription":"LUA server must be either a valid IPv4 address or left empty.","Description":"Enter an IP address of the LUA server that you want to use."},"LogsRetentionPeriod":{"Description":"Select the number of days to retain log groups.","Default":7,"Type":"Number","MaxValue":180,"MinValue":1,"AllowedValues":["1","3","5","7","14","30","60","90","120","150","180"],"ConstraintDescription":"Enter correct number of days to retain loggroups."},"MaximumPUInstances":{"Description":"Enter any value from 1 to 20.","Default":1,"Type":"Number","MaxValue":20,"MinValue":1,"ConstraintDescription":"MaximumPUInstances must be between MinimumPUInstances and 20 (both inclusive)."},"ProxyHost":{"Type":"String","Description":"Provide proxy server IP address"},"AvailabilityZones":{"MinLength":"1","Type":"List<AWS::EC2::AvailabilityZone::Name>","Description":"Select availability zones.","ConstraintDescription":"AvailabilityZones is a mandatory input parameter. Select availability zones."}},"AWSTemplateFormatVersion":"2010-09-09","Outputs":{"SQSURL":{"Description":"SQS URL for OnAccess","Value":{"Ref":"OnAccessSQS"}},"SNSName":{"Description":"SNS Name for OnAccess will be created with mentioned name as soon as deployment finished","Value":{"Fn::Join":["",[{"Ref":"Namespace"},"_OnAccessSNS"]]}},"PUIAMRole":{"Description":"IAMRole of PU","Value":{"Ref":"PUInstanceProfile"}},"PUAutoScalingGroup":{"Description":"Auto-Scaling ID of PU","Value":{"Ref":"PUGroupPolicy"}},"ControllerSecurityGroup":{"Description":"Security Group of Controller","Value":{"Ref":"ControllerSecurityGroup"}},"BucketConfigLogsForNRTS":{"Description":"Please visit mentioned log stream to check buckets configuration status for NRTS","Value":{"Fn::Join":["",["CloudWatch/Log Groups/",{"Ref":"Namespace"},"/Event/EventCU"]]}},"PUSecurityGroup":{"Description":"Security Group of PU","Value":{"Ref":"PUSecurityGroup"}},"KMSKey":{"Description":"KMS Key to generate rabbitMQ password","Value":{"Ref":"KMSKey"}},"ControllerAutoScalingGroup":{"Description":"Auto-Scaling ID of Controller","Value":{"Ref":"ControllerGroupPolicy"}},"SQSName":{"Description":"SQS Name for OnAccess","Value":{"Fn::GetAtt":["OnAccessSQS","QueueName"]}},"ControllerIAMRole":{"Description":"IAMRole of Controller","Value":{"Ref":"ControllerInstanceProfile"}}},"Description":"Version: 1.0.2.88. Cloud Workload Protection For Storage CloudFormation Template: Cloud Workload Protection for Storage helps you protect the data that is stored in AWS S3 buckets. **WARNING** This template creates one or more Amazon EC2 instances. You will be billed for the AWS resources used if you create a stack from this template!","Conditions":{"ProxyMode":{"Fn::Not":[{"Fn::Equals":[{"Ref":"ProxyHost"},""]}]},"NoNamespaceDynamoDB":{"Fn::Equals":[{"Ref":"Namespace"},""]},"NoDesiredCapacity":{"Fn::Equals":[{"Ref":"DesiredPUInstances"},0]},"AuthenticatedProxy":{"Fn::Not":[{"Fn::Equals":[{"Ref":"ProxyUser"},""]}]},"EnableNRTS":{"Fn::Equals":[{"Ref":"Enable"},"Yes"]}},"Resources":{"SPEPUSpecificPolicy":{"Type":"AWS::IAM::Policy","Properties":{"PolicyName":"SPEPUSpecificPolicy","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["dynamodb:GetItem","dynamodb:Scan","dynamodb:Query","dynamodb:PutItem"],"Resource":[{"Fn::Join":["",["arn:aws:dynamodb:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":table/",{"Ref":"Namespace"},".*"]]}],"Effect":"Allow"},{"Action":["cloudwatch:PutMetricData","cloudwatch:PutMetricAlarm"],"Resource":"*","Effect":"Allow"},{"Action":["autoscaling:SetInstanceHealth","autoscaling:PutLifecycleHook","autoscaling:DescribeAutoScalingInstances","autoscaling:DescribeLifecycleHooks","autoscaling:CompleteLifecycleAction","autoscaling:RecordLifecycleActionHeartbeat"],"Resource":"*","Effect":"Allow"},{"Action":["logs:PutLogEvents","logs:DescribeLogStreams","logs:DescribeLogGroups"],"Resource":[{"Fn::Join":["",["arn:aws:logs:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":log-group:",{"Ref":"Namespace"},"/*"]]}],"Effect":"Allow"}]},"Roles":[{"Ref":"PUIAMRole"}]}},"KMSKey":{"Type":"AWS::KMS::Key","Properties":{"KeyPolicy":{"Version":"2012-10-17","Id":"key-default-1","Statement":[{"Action":["kms:Create*","kms:Describe*","kms:Enable*","kms:List*","kms:Put*","kms:Update*","kms:Revoke*","kms:Disable*","kms:Get*","kms:Delete*","kms:ScheduleKeyDeletion","kms:CancelKeyDeletion"],"Sid":"Allow administration of the key","Resource":"*","Effect":"Allow","Principal":{"AWS":[{"Fn::Join":["",["arn:aws:iam::",{"Ref":"AWS::AccountId"},":root"]]}]}},{"Action":["kms:Encrypt","kms:Decrypt","kms:ReEncrypt*","kms:GenerateDataKey*","kms:DescribeKey"],"Sid":"Allow use of the key","Resource":"*","Effect":"Allow","Principal":{"AWS":[{"Fn::GetAtt":["ControllerIAMRole","Arn"]},{"Fn::GetAtt":["PUIAMRole","Arn"]}]}}]},"Description":"KMS key to generate encrypted password of RabbitMQ"}},"OnAccessQueuePolicy":{"Type":"AWS::SQS::QueuePolicy","Properties":{"Queues":[{"Ref":"OnAccessSQS"}],"PolicyDocument":{"Version":"2012-10-17","Id":"AllowOthersToSendToSPEQueue","Statement":[{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ListQueues","sqs:SendMessage"],"Sid":"1","Resource":{"Fn::GetAtt":["OnAccessSQS","Arn"]},"Effect":"Allow","Principal":{"Service":["s3.amazonaws.com","sns.amazonaws.com"]}}]}},"DependsOn":"OnAccessSQS"},"PUOutboundRuleToProxy":{"Type":"AWS::EC2::SecurityGroupEgress","Properties":{"ToPort":{"Ref":"ProxyPort"},"FromPort":{"Ref":"ProxyPort"},"IpProtocol":"tcp","GroupId":{"Fn::GetAtt":["PUSecurityGroup","GroupId"]},"CidrIp":"0.0.0.0/0"},"Condition":"ProxyMode"},"CuLifeCycleHook":{"Type":"AWS::AutoScaling::LifecycleHook","Properties":{"HeartbeatTimeout":1200,"NotificationTargetARN":{"Ref":"AlarmNotificationTopic"},"AutoScalingGroupName":{"Ref":"ControllerGroupPolicy"},"RoleARN":{"Fn::GetAtt":["AlarmNotificationRole","Arn"]},"LifecycleTransition":"autoscaling:EC2_INSTANCE_TERMINATING"}},"SPEControllerSpecificPolicy":{"Type":"AWS::IAM::Policy","Properties":{"PolicyName":"SPEControllerSpecificPolicy","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["dynamodb:GetItem","dynamodb:PutItem","dynamodb:DeleteItem","dynamodb:UpdateItem","dynamodb:Scan","dynamodb:Query","dynamodb:BatchWriteItem"],"Resource":[{"Fn::Join":["",["arn:aws:dynamodb:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":table/",{"Ref":"Namespace"},".*"]]}],"Effect":"Allow"},{"Action":["cloudwatch:PutMetricData","cloudwatch:PutMetricAlarm"],"Resource":"*","Effect":"Allow"},{"Action":["autoscaling:putScalingPolicy","autoscaling:SetInstanceHealth","autoscaling:describeAutoScalingGroups","autoscaling:setDesiredCapacity","autoscaling:PutLifecycleHook","autoscaling:DescribeAutoScalingInstances","autoscaling:DescribeLifecycleHooks","autoscaling:CompleteLifecycleAction","autoscaling:RecordLifecycleActionHeartbeat","ec2:DescribeInstances"],"Resource":"*","Effect":"Allow"},{"Action":["sqs:receiveMessage","sqs:deleteMessage","sqs:PurgeQueue","sqs:setQueueAttributes"],"Resource":[{"Fn::Join":["",["arn:aws:sqs:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":",{"Ref":"Namespace"},"*"]]}],"Effect":"Allow"},{"Action":["sns:createTopic","sns:subscribe","sns:setTopicAttributes"],"Resource":[{"Fn::Join":["",["arn:aws:sns:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":",{"Ref":"Namespace"},"*"]]}],"Effect":"Allow"},{"Action":["logs:PutLogEvents","logs:DescribeLogStreams","logs:DescribeLogGroups","logs:FilterLogEvents","logs:GetLogEvents","logs:PutRetentionPolicy"],"Resource":[{"Fn::Join":["",["arn:aws:logs:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":log-group:",{"Ref":"Namespace"},"/*"]]}],"Effect":"Allow"}]},"Roles":[{"Ref":"ControllerIAMRole"}]}},"CUInboundRule":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"ToPort":"5671","IpProtocol":"tcp","SourceSecurityGroupId":{"Fn::GetAtt":["PUSecurityGroup","GroupId"]},"GroupId":{"Fn::GetAtt":["ControllerSecurityGroup","GroupId"]},"FromPort":"5671"}},"PUIAMRole":{"Type":"AWS::IAM::Role","Properties":{"Path":"/PU/","AssumeRolePolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":["ec2.amazonaws.com"]}}]}}},"RemediationException":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"bucketName"},{"KeyType":"RANGE","AttributeName":"createdTime"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","remediation_exception",{"Fn::Join":["",[{"Ref":"Namespace"},".remediation_exception"]]}]},"AttributeDefinitions":[{"AttributeName":"bucketName","AttributeType":"S"},{"AttributeName":"createdTime","AttributeType":"N"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"Job"},"PuLifeCycleHook":{"Type":"AWS::AutoScaling::LifecycleHook","Properties":{"HeartbeatTimeout":1200,"NotificationTargetARN":{"Ref":"AlarmNotificationTopic"},"AutoScalingGroupName":{"Ref":"PUGroupPolicy"},"RoleARN":{"Fn::GetAtt":["AlarmNotificationRole","Arn"]},"LifecycleTransition":"autoscaling:EC2_INSTANCE_TERMINATING"}},"PUSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"SecurityGroupIngress":[{"ToPort":"22","IpProtocol":"tcp","FromPort":"22","CidrIp":{"Ref":"SSHLocation"}}],"VpcId":{"Ref":"VPCID"},"GroupDescription":"Enable ICAP access, RabbitMQ access and SSH access for SPE-S3-Controller","SecurityGroupEgress":[{"ToPort":"80","IpProtocol":"tcp","FromPort":"80","CidrIp":"0.0.0.0/0"},{"ToPort":"443","IpProtocol":"tcp","FromPort":"443","CidrIp":"0.0.0.0/0"}]}},"ControllerScheduleTable":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"scheduleId"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","controller_schedule",{"Fn::Join":["",[{"Ref":"Namespace"},".controller_schedule"]]}]},"AttributeDefinitions":[{"AttributeName":"scheduleId","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"MeteringData"},"ControllerLaunchConfig":{"Type":"AWS::AutoScaling::LaunchConfiguration","Properties":{"UserData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash -xe\n",{"Fn::If":["ProxyMode",{"Fn::Join":["",["export http_proxy=","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"\n","export HTTPS_PROXY=","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"\n","export NO_PROXY=169.254.169.254","\n"]]},{"Ref":"AWS::NoValue"}]},"/usr/bin/cfn-init -v ","         --stack ",{"Ref":"AWS::StackName"},"         --resource ControllerLaunchConfig ",{"Fn::If":["ProxyMode",{"Fn::Join":["",["              --http-proxy ","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"              --https-proxy ","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"}]]},{"Ref":"AWS::NoValue"}]},"         --region ",{"Ref":"AWS::Region"},"\n","/usr/bin/cfn-signal -e $? ","         --stack ",{"Ref":"AWS::StackName"},"         --resource ControllerGroupPolicy ","         --region ",{"Ref":"AWS::Region"},"\n"]]}},"ImageId":{"Fn::FindInMap":["AWSRegionArch2AMIController",{"Ref":"AWS::Region"},{"Fn::FindInMap":["AWSInstanceType2Arch",{"Ref":"ControllerInstanceType"},"Arch"]}]},"KeyName":{"Ref":"KeyPairName"},"SecurityGroups":[{"Ref":"ControllerSecurityGroup"}],"IamInstanceProfile":{"Ref":"ControllerInstanceProfile"},"InstanceType":{"Ref":"ControllerInstanceType"},"AssociatePublicIpAddress":"true"},"Metadata":{"Comment":"Controller Deployment","AWS::CloudFormation::Init":{"config":{"files":{"/usr/local/symantec/spe/spe-s3-protection-controller-service/config/config.properties":{"content":{"Fn::Join":["",["rabbitmq.host=127.0.0.1\n","rabbitmq.username=spemq\n","rabbitmq.port=5671\n","rabbitmq.usessl=true\n","rabbitmq.vhost=spemqvhost\n\n","file.quartz.properties=config/quartz.properties\n\n\n","spe.dbclient.dynamodb.ep=\n","spe.s3.namespace=",{"Ref":"Namespace"},"\n","spe.userschedules.limit=25\n\n","#FILE_MODE\n","scheduler.command.mode=\n","file.init.command=S3InitCommands.xml\n","file.process.command=S3SchedulerCommands.xml\n\n","# S3 Connector specific Configuration\n","s3.policyname=FactoryShippedPolicy\n","scan.exchange=spe.s3.scan.exchange\n\n","spe.s3.applicationevent.loglevel=\n\n","controlmessages.exchange=spe.s3.controlmessages.exchange\n\n","#rabbit mq prop\n","rabbitmq.backoffpolicy.initialinterval=500\n","rabbitmq.backoffpolicy.maxinterval=10000\n","rabbitmq.backoffpolicy.multiplier=2\n","rabbitmq.retrypolicy.maxattempts=5\n\n","s3.eventreporter.actions.directorypath=./cwlogs/statistics\n","s3.eventreporter.actions.filename=statistics.log\n","spe.s3.region=",{"Ref":"AWS::Region"},"\n","spe.instance.id=\n","spe.s3.eventreporter.maxfilesize = 1024MB\n\n","spe.s3.common.config.setting.file=/usr/local/symantec/spe/settings/config.settings\n","s3.eventreporter.scanerror.directorypath=./cwlogs/violation/scanerror\n","s3.eventreporter.scanerror.filename=scanerrors.log\n","s3.policyId=38f68cae-c6e9-4ea8-87e3-0b8ec20469f5\n\n","s3.eventreporter.controllerevent.directorypath=./cwlogs/event/controller\n","s3.eventreporter.controllerevent.filename=event.log\n\n","s3.eventreporter.permissions.directorypath=./cwlogs/assessment/config\n","s3.eventreporter.permissions.filename=permission.log\n\n","purge.jobs.duration.days=90\n","purge.modulo.hours=24\n\n","#Throttling\n","throttling.schedule.queue.max.items=100000\n","throttling.schedule.queue.throttle.items=1000\n","throttling.nrts.queue.max.items=100000\n","throttling.nrts.queue.throttle.items=1000\n\n","#CW Client \n","spe.s3.cwclient.cw.ep=\n","spe.s3.cwclient.cw.retryInterval=5\n","spe.s3.cwclient.cw.maxRetries=10\n\n","spe.s3.cwclient.cw.apiratelimit=5\n\n","spe.s3.cwclient.cw.waitForEventsInterval=120000\n\n","spe.s3.ipc.server.controller.ip=127.0.0.1\n","spe.s3.ipc.server.controller.port=9002\n","spe.s3.ipc.server.caf.ip=127.0.0.1\n","spe.s3.ipc.server.caf.port=9001\n","spe.s3.ipc.server.maxQueued=64\n\n","spe.s3.metering.timeperiod=30\n\n","event.exchange=spe.s3.event.exchange\n","spe.s3.ipc.events.dir=/usr/local/symantec/spe/caf-controller-ipc/events\n","spe.s3.events.timeperiod=30\n","spe.s3.proxy.host=",{"Ref":"ProxyHost"},"\n","spe.s3.proxy.port=",{"Ref":"ProxyPort"},"\n","spe.s3.proxy.user=",{"Ref":"ProxyUser"},"\n","spe.s3.keystore.path=","\n","spe.s3.password.path=","\n","spe.s3.proxy.encpassword=","\n\n","aws.dynamo.batchsize=25","\n"]]},"owner":"speservice","group":"speservice","mode":"000640"},"/usr/local/symantec/spe/command-gateway/config/config.properties":{"content":{"Fn::Join":["",["spe.dbclient.dynamodb.ep=\n","spe.s3.namespace=",{"Ref":"Namespace"},"\n","spe.userschedules.limit=25\n\n","spe.snsclient.reporting.topic=\n","spe.s3.region=",{"Ref":"AWS::Region"},"\n\n","spe.s3.cwclient.cw.ep=\n","spe.s3.cwclient.cw.retryInterval=5\n","spe.s3.cwclient.cw.maxRetries=10\n\n","spe.s3.cwclient.cw.apiratelimit=5\n","spe.cg.reportingDir=Reporting\n","spe.cg.reporting.batchSize=2000\n","spe.cg.reporting.threadsPerDay=1\n","spe.s3.proxy.host=",{"Ref":"ProxyHost"},"\n","spe.s3.proxy.port=",{"Ref":"ProxyPort"},"\n","spe.s3.proxy.user=",{"Ref":"ProxyUser"},"\n","spe.s3.keystore.path=","\n","spe.s3.password.path=","\n","spe.s3.proxy.encpassword=","\n"]]},"owner":"speservice","group":"speservice","mode":"000660"},"/usr/local/symantec/spe/spe-cloudwatch-rabbitmq-metric-service/config/config.properties":{"content":{"Fn::Join":["",["#rabbitMQ config\n","rabbitMQ.host = 127.0.0.1\n","rabbitMQ.username = spemq\n","rabbitMQ.vhost = spemqvhost\n","rabbitMQ.sched_queue_name = FactoryShippedPolicy_SCANREQUEST_SCHEDULED\n","rabbitMQ.nrts_queue_name = FactoryShippedPolicy_SCANREQUEST_ONACCESSSCAN\n","rabbitMQ.port = 5671\n","rabbitMQ.frequencyPutMetric = 60\n\n","spe.userschedules.limit=25\n","spe.dbclient.dynamodb.ep=\n","#No. of requests SPE scans in 1 hour\n","NumberOfFilesSPEScansInOneHour = 100000\n","spe.cwmetric.ep.queuelimit = 400000\n","spe.cwmetric.ep.stackName = ",{"Ref":"AWS::StackName"},"\n","spe.cwmetric.ep.avginterval = 4\n\n","s3.policyname=testpolicy\n","s3.policyId=38f68cae-c6e9-4ea8-87e3-0b8ec20469f5\n\n","s3.eventreporter.cwevent.directorypath=./cwlogs/event/cwevent\n","s3.eventreporter.cwevent.filename=event.log\n","# Health Reporting Log Level Severity specific configuration\n","spe.s3.applicationevent.loglevel=\n","spe.s3.namespace = ",{"Ref":"Namespace"},"\n","spe.s3.region = ",{"Ref":"AWS::Region"},"\n","spe.s3.proxy.host=",{"Ref":"ProxyHost"},"\n","spe.s3.proxy.port=",{"Ref":"ProxyPort"},"\n","spe.s3.proxy.user=",{"Ref":"ProxyUser"},"\n","spe.s3.keystore.path=","\n","spe.s3.password.path=","\n","spe.s3.proxy.encpassword=","\n"]]},"owner":"speservice","group":"speservice","mode":"000640"},"/usr/local/symantec/spe/settings/config.settings":{"content":{"Fn::Join":["",["NRTS=",{"Ref":"Enable"},"\n","KMSKey=",{"Ref":"KMSKey"},"\n","SQSName=",{"Fn::GetAtt":["OnAccessSQS","QueueName"]},"\n","SQS-URLink=",{"Ref":"OnAccessSQS"},"\n","LogsRetentionPeriod=",{"Ref":"LogsRetentionPeriod"},"\n","CFTVersion=1.0.2.88\n","Namespace=",{"Ref":"Namespace"},"\n","Region=",{"Ref":"AWS::Region"},"\n","ControllerInstanceType=",{"Ref":"ControllerInstanceType"},"\n","PUInstanceType=",{"Ref":"PUInstanceType"},"\n","MaxPUInstances=",{"Ref":"MaximumPUInstances"},"\n","DesPUInstances=",{"Ref":"DesiredPUInstances"},"\n","MinPUInstances=",{"Ref":"MinimumPUInstances"},"\n","EnableLUA=No\n","StackName=",{"Ref":"AWS::StackName"},"\n","CustomerId=",{"Ref":"CustomerId"},"\n","DomainId=",{"Ref":"DomainId"},"\n","SecretKey=",{"Ref":"SecretKey"},"\n","account_id=",{"Ref":"AWS::AccountId"},"\n","ami_id=",{"Fn::FindInMap":["AWSRegionArch2AMIController",{"Ref":"AWS::Region"},{"Fn::FindInMap":["AWSInstanceType2Arch",{"Ref":"ControllerInstanceType"},"Arch"]}]},"\n","queue_arn=",{"Fn::GetAtt":["OnAccessSQS","Arn"]},"\n","BUCKET_CONFIGURATION_REQ=",{"Ref":"AutomaticBucketConfiguration"},"\n","NEW_SERVER_ADDR=scwp.securitycloud.symantec.com\n","NEW_PORT=443\n","NEW_SERVICE_PORTAL_NAME=dcs-service\n","PROXY_MODE=",{"Fn::If":["ProxyMode","Manual","Disabled"]},"\n","PROXY_ADDR=",{"Fn::If":["ProxyMode",{"Fn::Join":["",[{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"}]]},""]},"\n","PROXY_USERNAME=",{"Ref":"ProxyUser"},"\n","PROXY_PASSWORD=",{"Ref":"ProxyPassword"},"\n","CONFIG_DIR=\\/etc\\/caf\n","NEW_PROTOCOL=https\n","POLL_TIME_MINUTES=2\n"]]}}},"commands":{"02-set-syslog-config":{"command":"/usr/local/symantec/spe/settings/set_syslog_config.sh"},"12-controller-service-start":{"command":"/usr/local/symantec/spe/settings/service_start.sh spe-s3-protection-controller-service"},"04-update-settings-dbtable":{"command":"python /usr/local/symantec/spe/settings/UpdateSettingsInDB.py"},"07-autoscaling-config":{"command":"/usr/local/symantec/spe/settings/autoscaling_config.sh"},"15-cloudwatch-rabbitmq-metric-service-start":{"command":"/usr/local/symantec/spe/settings/service_start.sh spe-cloudwatch-rabbitmq-metric-service"},"09-put-retention-policy":{"command":"/usr/local/symantec/spe/settings/set_logretention_period.sh"},"13-caf-start":{"command":"/etc/init.d/cafagent start"},"00-telemetry-info-update":{"command":"python /usr/local/symantec/spe/settings/telemetry_info_update.py SPEForAWSS3 symantec_ext AWS"},"18-remove-confidential-details":{"command":"/usr/local/symantec/spe/settings/empty_confidential_details.sh"},"11-awslogs-start":{"command":"/usr/local/symantec/spe/settings/service_start.sh awslogs"},"08-cw-agent-settings":{"command":"/usr/local/symantec/spe/settings/cw-agent-conf.sh"},"01-set-key-store":{"command":"/usr/local/symantec/spe/settings/setup-keystore-cu.sh"},"10-caf-config-update":{"command":"/usr/local/symantec/spe/settings/caf_config.sh"},"14-enroll-check":{"command":"/usr/local/symantec/spe/settings/enroll_check.sh"},"16-unhealthy-status-check":{"command":"/usr/local/symantec/spe/settings/set_cron_job.sh"},"05-get-loglevel-settings":{"command":"python /usr/local/symantec/spe/settings/GetSettingsFromDB.py CONTROLLER"},"17-configure-nrts-buckets":{"command":"/usr/local/symantec/spe/settings/configure-nrts-buckets.sh"},"06-set-cwmetric-loglevel":{"command":"/usr/local/symantec/spe/settings/set_cwmetricservice_loglevel.sh"},"03-rabbitmq-configuration":{"command":"/usr/local/symantec/spe/settings/rabbitmq_config.sh"}}}}}},"Job":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"jobId"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","job",{"Fn::Join":["",[{"Ref":"Namespace"},".job"]]}]},"AttributeDefinitions":[{"AttributeName":"jobId","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"ControllerScheduleTable"},"CloudWatchLogStream":{"Type":"AWS::IAM::Policy","Properties":{"PolicyName":"CloudWatchLogsCreatePolicy","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:filterLogEvents","logs:getLogEvents"],"Resource":[{"Fn::Join":["",["arn:aws:logs:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":*"]]}],"Effect":"Allow"}]},"Roles":[{"Ref":"ControllerIAMRole"},{"Ref":"PUIAMRole"}]}},"CUOutboundRuleToProxy":{"Type":"AWS::EC2::SecurityGroupEgress","Properties":{"ToPort":{"Ref":"ProxyPort"},"FromPort":{"Ref":"ProxyPort"},"IpProtocol":"tcp","GroupId":{"Fn::GetAtt":["ControllerSecurityGroup","GroupId"]},"CidrIp":"0.0.0.0/0"},"Condition":"ProxyMode"},"SynchObjectStats":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"syncType"},{"KeyType":"RANGE","AttributeName":"componentName"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","sync_object_stats",{"Fn::Join":["",[{"Ref":"Namespace"},".sync_object_stats"]]}]},"AttributeDefinitions":[{"AttributeName":"syncType","AttributeType":"S"},{"AttributeName":"componentName","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"RemediationDetails"},"ControllerInstanceProfile":{"Type":"AWS::IAM::InstanceProfile","Properties":{"Path":"/Controller/","Roles":[{"Ref":"ControllerIAMRole"}]}},"PUInstanceProfile":{"Type":"AWS::IAM::InstanceProfile","Properties":{"Path":"/PU/","Roles":[{"Ref":"PUIAMRole"}]}},"PUOutboundRule":{"Type":"AWS::EC2::SecurityGroupEgress","Properties":{"ToPort":"5671","IpProtocol":"tcp","GroupId":{"Fn::GetAtt":["PUSecurityGroup","GroupId"]},"DestinationSecurityGroupId":{"Fn::GetAtt":["ControllerSecurityGroup","GroupId"]},"FromPort":"5671"}},"AlarmNotificationRole":{"Type":"AWS::IAM::Role","Properties":{"Policies":[{"PolicyName":"AlarmNotificationPolicy","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["sqs:SendMessage","sqs:GetQueueUrl","sns:Publish"],"Resource":"*","Effect":"Allow"}]}}],"AssumeRolePolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":["autoscaling.amazonaws.com"]}}]}}},"ControllerSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"SecurityGroupIngress":[{"ToPort":"22","IpProtocol":"tcp","FromPort":"22","CidrIp":{"Ref":"SSHLocation"}}],"VpcId":{"Ref":"VPCID"},"GroupDescription":"Enable RabbitMQ access and SSH access for SPE-S3-ProtectionUnit","SecurityGroupEgress":[{"ToPort":"80","IpProtocol":"tcp","FromPort":"80","CidrIp":"0.0.0.0/0"},{"ToPort":"443","IpProtocol":"tcp","FromPort":"443","CidrIp":"0.0.0.0/0"}]}},"MeteringData":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"dateString"},{"KeyType":"RANGE","AttributeName":"slot"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","MeteringData",{"Fn::Join":["",[{"Ref":"Namespace"},".MeteringData"]]}]},"AttributeDefinitions":[{"AttributeName":"dateString","AttributeType":"S"},{"AttributeName":"slot","AttributeType":"N"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"Command"},"S3PolicyAdapter":{"Type":"AWS::IAM::Policy","Properties":{"PolicyName":"SPES3PolicyPU","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["s3:ListBucket","s3:ListBucketVersions","s3:ListAllMyBuckets","s3:GetBucketNotification","s3:PutBucketNotification","s3:GetBucketLocation","s3:PutObject","s3:PutObjectAcl","s3:PutObjectVersionAcl","s3:GetObject","s3:GetObjectVersion","s3:GetObjectAcl","s3:GetObjectVersionAcl","s3:DeleteObject","s3:DeleteObjectVersion","s3:GetBucketVersioning","s3:GetObjectTagging","s3:GetObjectVersionTagging","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Resource":"arn:aws:s3:::*","Effect":"Allow"}]},"Roles":[{"Ref":"PUIAMRole"}]}},"Command":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"commandId"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","command",{"Fn::Join":["",[{"Ref":"Namespace"},".command"]]}]},"AttributeDefinitions":[{"AttributeName":"commandId","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"OriginalSettings"},"OriginalSettings":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"componentType"},{"KeyType":"RANGE","AttributeName":"settingType"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","settings",{"Fn::Join":["",[{"Ref":"Namespace"},".settings"]]}]},"AttributeDefinitions":[{"AttributeName":"componentType","AttributeType":"S"},{"AttributeName":"settingType","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"SynchObjectStats"},"OnAccessSQS":{"Type":"AWS::SQS::Queue","Properties":{"VisibilityTimeout":1800,"QueueName":{"Fn::If":["NoNamespaceDynamoDB","OnAccessQueue",{"Fn::Join":["",[{"Ref":"Namespace"},"_OnAccessQueue"]]}]}}},"AlarmNotificationTopic":{"Type":"AWS::SNS::Topic","Properties":{"Subscription":[{"Endpoint":{"Ref":"Email"},"Protocol":"email"}]}},"RemediationDetails":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"bucketName"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","remediation_details",{"Fn::Join":["",[{"Ref":"Namespace"},".remediation_details"]]}]},"AttributeDefinitions":[{"AttributeName":"bucketName","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"UserScheduleTable"},"PUGroupPolicy":{"Properties":{"DesiredCapacity":{"Ref":"DesiredPUInstances"},"Tags":[{"Value":{"Fn::Join":["",[{"Ref":"AWS::StackName"},"-",{"Ref":"Namespace"},"-ProtectionUnit"]]},"PropagateAtLaunch":"true","Key":"Name"}],"VPCZoneIdentifier":{"Ref":"Subnets"},"MinSize":{"Ref":"MinimumPUInstances"},"MaxSize":{"Ref":"MaximumPUInstances"},"Cooldown":"180","LaunchConfigurationName":{"Ref":"PULaunchConfig"},"MetricsCollection":[{"Granularity":"1Minute"}],"AvailabilityZones":{"Ref":"AvailabilityZones"}},"DependsOn":"ControllerGroupPolicy","Type":"AWS::AutoScaling::AutoScalingGroup","UpdatePolicy":{"AutoScalingReplacingUpdate":{"WillReplace":true}},"CreationPolicy":{"ResourceSignal":{"Count":{"Fn::If":["NoDesiredCapacity","0","1"]},"Timeout":"PT20M"}}},"PULaunchConfig":{"Type":"AWS::AutoScaling::LaunchConfiguration","Properties":{"UserData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash -xe\n",{"Fn::If":["ProxyMode",{"Fn::Join":["",["export http_proxy=","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"\n","export HTTPS_PROXY=","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"\n","export NO_PROXY=169.254.169.254","\n"]]},{"Ref":"AWS::NoValue"}]},"\n","# LUASERVER= ",{"Ref":"LUAServer"},"\n","/usr/bin/cfn-init -v ","         --stack ",{"Ref":"AWS::StackName"},"         --resource PULaunchConfig","         --region ",{"Ref":"AWS::Region"},"\n","/usr/bin/cfn-signal -e $? ","         --stack ",{"Ref":"AWS::StackName"},"         --resource PUGroupPolicy","         --region ",{"Ref":"AWS::Region"},{"Fn::If":["ProxyMode",{"Fn::Join":["",["              --http-proxy ","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"},"              --https-proxy ","http://",{"Fn::If":["AuthenticatedProxy",{"Fn::Join":["",[{"Ref":"ProxyUser"},":",{"Ref":"ProxyPassword"},"@"]]},""]},{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"}]]},{"Ref":"AWS::NoValue"}]},"\n"]]}},"ImageId":{"Fn::FindInMap":["AWSRegionArch2AMIPU",{"Ref":"AWS::Region"},{"Fn::FindInMap":["AWSInstanceType2Arch",{"Ref":"PUInstanceType"},"Arch"]}]},"KeyName":{"Ref":"KeyPairName"},"SecurityGroups":[{"Ref":"PUSecurityGroup"}],"IamInstanceProfile":{"Ref":"PUInstanceProfile"},"InstanceType":{"Ref":"PUInstanceType"},"AssociatePublicIpAddress":"true"},"Metadata":{"Comment":"PU (Protection Unit) Deployment","AWS::CloudFormation::Init":{"config":{"files":{"/usr/local/symantec/spe/settings/config.settings":{"content":{"Fn::Join":["",["Namespace=",{"Ref":"Namespace"},"\n","Region=",{"Ref":"AWS::Region"},"\n","EnableLUA=No\n","LUAServer=",{"Ref":"LUAServer"},"\n","NEW_SERVER_ADDR=scwp.securitycloud.symantec.com\n","NEW_PORT=443\n","NEW_SERVICE_PORTAL_NAME=dcs-service\n","NEW_PROTOCOL=https\n","PROXY_MODE=",{"Fn::If":["ProxyMode","Manual","Disabled"]},"\n","PROXY_ADDR=",{"Fn::If":["ProxyMode",{"Fn::Join":["",[{"Ref":"ProxyHost"},":",{"Ref":"ProxyPort"}]]},""]},"\n","PROXY_USERNAME=",{"Ref":"ProxyUser"},"\n","PROXY_PASSWORD=",{"Ref":"ProxyPassword"},"\n"]]}},"/usr/local/symantec/spe/spe-s3-protection-adapter-service/config/config.properties":{"content":{"Fn::Join":["",["spe.dbclient.dynamodb.ep=\n","spe.s3.namespace=",{"Ref":"Namespace"},"\n","spe.s3.applicationevent.loglevel=\n","spe.s3.region=",{"Ref":"AWS::Region"},"\n","spe.instance.id=\n","spe.s3.proxy.host=",{"Ref":"ProxyHost"},"\n","spe.s3.proxy.port=",{"Ref":"ProxyPort"},"\n","spe.s3.proxy.user=",{"Ref":"ProxyUser"},"\n","spe.s3.keystore.path=","\n","spe.s3.password.path=","\n","spe.s3.proxy.encpassword=","\n"]]},"owner":"speservice","group":"speservice","mode":"000640"}},"commands":{"05-install-spe":{"command":"/opt/spe-install-script.sh; /opt/cleanup.sh; rm -f /opt/cleanup.sh"},"00-set-syslog-config":{"command":"/usr/local/symantec/spe/settings/set_syslog_config.sh"},"08-unhealthy-status-check":{"command":"/usr/local/symantec/spe/settings/set_cron_job.sh"},"03-awslogs-start":{"command":"/usr/local/symantec/spe/settings/service_start.sh awslogs"},"07-call-liveupdate":{"command":"/usr/local/symantec/spe/settings/callcheckAVUpdated.sh &"},"04-set-spe-settings":{"command":"/usr/local/symantec/spe/settings/set_spe_config.sh"},"06-get-adapter-settings":{"command":"python /usr/local/symantec/spe/settings/GetSettingsFromDB.py ADAPTER"},"01-cw-agent-settings":{"command":"/usr/local/symantec/spe/settings/cw-agent-conf.sh"},"09-remove-confidential-details":{"command":"/usr/local/symantec/spe/settings/empty_confidential_details.sh"},"02-update-prefetch-count":{"command":"/usr/local/symantec/spe/settings/update_prefetch_count.sh"}}}}}},"S3PolicyController":{"Type":"AWS::IAM::Policy","Properties":{"PolicyName":"SPES3PolicyController","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["s3:ListBucket","s3:ListBucketVersions","s3:ListAllMyBuckets","s3:GetBucketNotification","s3:PutBucketNotification","s3:GetBucketLocation","s3:GetObject","s3:GetObjectVersion","s3:GetObjectAcl","s3:GetObjectVersionAcl","s3:GetBucketPolicy","s3:PutBucketPolicy","s3:DeleteBucketPolicy"],"Resource":"arn:aws:s3:::*","Effect":"Allow"}]},"Roles":[{"Ref":"ControllerIAMRole"}]}},"UserScheduleTable":{"Type":"AWS::DynamoDB::Table","Properties":{"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"},"TableName":{"Fn::If":["NoNamespaceDynamoDB","user_schedule",{"Fn::Join":["",[{"Ref":"Namespace"},".user_schedule"]]}]},"KeySchema":[{"KeyType":"HASH","AttributeName":"scheduleId"},{"KeyType":"RANGE","AttributeName":"createdTime"}],"AttributeDefinitions":[{"AttributeName":"scheduleId","AttributeType":"S"},{"AttributeName":"scheduleName","AttributeType":"S"},{"AttributeName":"createdTime","AttributeType":"N"}],"GlobalSecondaryIndexes":[{"KeySchema":[{"KeyType":"HASH","AttributeName":"scheduleName"},{"KeyType":"RANGE","AttributeName":"createdTime"}],"IndexName":"userScheduleGSI","Projection":{"ProjectionType":"INCLUDE","NonKeyAttributes":["isDeleted","scheduleId"]},"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}}]}},"ControllerGroupPolicy":{"Properties":{"DesiredCapacity":"1","Tags":[{"Value":{"Fn::Join":["",[{"Ref":"AWS::StackName"},"-",{"Ref":"Namespace"},"-Controller"]]},"PropagateAtLaunch":"true","Key":"Name"}],"MinSize":"1","MaxSize":"1","VPCZoneIdentifier":{"Ref":"Subnets"},"LaunchConfigurationName":{"Ref":"ControllerLaunchConfig"},"AvailabilityZones":{"Ref":"AvailabilityZones"}},"DependsOn":"Asset","Type":"AWS::AutoScaling::AutoScalingGroup","UpdatePolicy":{"AutoScalingReplacingUpdate":{"WillReplace":true}},"CreationPolicy":{"ResourceSignal":{"Timeout":"PT20M"}}},"ControllerIAMRole":{"Type":"AWS::IAM::Role","Properties":{"Path":"/Controller/","AssumeRolePolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":["ec2.amazonaws.com"]}}]}}},"Asset":{"Type":"AWS::DynamoDB::Table","Properties":{"KeySchema":[{"KeyType":"HASH","AttributeName":"assetName"}],"TableName":{"Fn::If":["NoNamespaceDynamoDB","asset",{"Fn::Join":["",[{"Ref":"Namespace"},".asset"]]}]},"AttributeDefinitions":[{"AttributeName":"assetName","AttributeType":"S"}],"ProvisionedThroughput":{"WriteCapacityUnits":"5","ReadCapacityUnits":"5"}},"DependsOn":"RemediationException"}},"Metadata":{"AWS::CloudFormation::Interface":{"ParameterGroups":[{"Parameters":["Enable","AutomaticBucketConfiguration"],"Label":{"default":"Near Real-Time Scan Configuration"}},{"Parameters":["AvailabilityZones","VPCID","Subnets","SSHLocation"],"Label":{"default":"Network Configuration (*)"}},{"Parameters":["ControllerInstanceType","PUInstanceType","MinimumPUInstances","MaximumPUInstances","DesiredPUInstances","KeyPairName","Email","LogsRetentionPeriod"],"Label":{"default":"Auto Scaling and EC2 Instance Configuration (*)"}},{"Parameters":["Namespace"],"Label":{"default":"Resource Name Prefix (*)"}},{"Parameters":["LUAServer"],"Label":{"default":"LiveUpdate Administrator (LUA) Configuration"}},{"Parameters":["CustomerId","DomainId","SecretKey"],"Label":{"default":"Configuration for Centralized Management & Console (*)"}},{"Parameters":["ProxyHost","ProxyPort","ProxyUser","ProxyPassword"],"Label":{"default":"Proxy Server Configuration"}},{"Label":{"default":"Section marked as '*' are mandatory."}}],"ParameterLabels":{"ProxyPort":{"default":"Port"},"MinimumPUInstances":{"default":"Minimum PU Instances"},"VPCID":{"default":"Virtual Private Cloud (VPC) ID"},"DesiredPUInstances":{"default":"Desired PU Instances"},"ProxyUser":{"default":"User Name"},"Namespace":{"default":"Prefix"},"SSHLocation":{"default":"SSH Location"},"DomainId":{"default":"Domain ID"},"Email":{"default":"Email"},"ControllerInstanceType":{"default":"Controller Instance Type"},"Subnets":{"default":"Subnets"},"Enable":{"default":"Enable"},"CustomerId":{"default":"Customer ID"},"SecretKey":{"default":"Secret Key"},"PUInstanceType":{"default":"Protection Unit (PU) Instance Type"},"KeyPairName":{"default":"Key Pair Name"},"AutomaticBucketConfiguration":{"default":"Configure S3 Bucket Notifications"},"ProxyPassword":{"default":"Password"},"LUAServer":{"default":"LUA Server IP"},"LogsRetentionPeriod":{"default":"Logs Retention Period (days)"},"MaximumPUInstances":{"default":"Maximum PU Instances"},"ProxyHost":{"default":"Proxy Server IP"},"AvailabilityZones":{"default":"Availability Zones"}}}}}